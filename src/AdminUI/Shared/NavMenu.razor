@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using System.Reflection.Metadata
@using SSW.Rewards.Admin.UI.Helpers

@inject NavigationManager Navigation

<MudNavMenu Style="display:flex; flex-direction: column; justify-content: space-between; height: 100vh; margin-bottom: 16px; overflow: hidden;">
    <MudStack Spacing="2"  >
        <AuthorizeView Roles="Admin, Staff">
            @foreach (var staffPage in NavigationPages.StaffPages())
            {
                <MudNavLink Href="@staffPage.Href" Match="NavLinkMatch.Prefix" Icon="@staffPage.Icon">@staffPage.Title</MudNavLink>
                <MudDivider Style="background-color: black"/>
            }
        </AuthorizeView>
        <!-- Admin only links -->
        <AuthorizeView Roles="Admin" Context="sub_context">
            @foreach (var adminPage in NavigationPages.AdminPages())
            {
                <MudNavLink Href="@adminPage.Href" Match="NavLinkMatch.Prefix" Icon="@adminPage.Icon">@adminPage.Title</MudNavLink>
                <MudDivider Style="background-color: black"/>
            }
        </AuthorizeView>
    </MudStack>
    
    <AuthorizeView>
        @if (!IsOpen)
        {
            <MudIconButton 
                Variant="Variant.Filled"
                Color="Color.Primary"
                Icon="@Icons.Material.Outlined.Logout"
                OnClick="@BeginSignOut"
                Style="margin: 8px;"/>
        }
        else
        {
            <MudButton
                Variant="Variant.Filled"
                Color="Color.Primary"
                StartIcon="@Icons.Material.Outlined.Logout"
                OnClick="@BeginSignOut"
                Style="margin: 8px;">
                Log Out
            </MudButton>
        }
    </AuthorizeView>
</MudNavMenu>

@code {
    [Parameter] public bool IsOpen { get; set; }
    
    private void BeginSignOut(MouseEventArgs args)
    {
        Navigation.NavigateToLogout("authentication/logout");
    }

}